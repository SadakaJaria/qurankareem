<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--gold:#d4af37;}
body{font-family:"Noto Naskh Arabic UI","Segoe UI",system-ui,sans-serif;transition:background .3s,color .3s}

/* ====== Ø¹Ù†Ø§ØµØ± Ø¹Ø§Ù…Ø© ====== */
.card{border-radius:.75rem;box-shadow:0 4px 12px rgba(0,0,0,.12)}
.btn{padding:.45rem .9rem;border-radius:.65rem;font-weight:600}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,.15)}
.btn-gold{background:var(--gold);color:#1f2937}.btn-gold:hover{filter:brightness(1.05)}
.btn-danger{background:#ef4444;color:#fff}.btn-danger:hover{background:#dc2626}

/* ====== Ø«ÙŠÙ…Ø§Øª ====== */
.theme-day{background:#f8fafc;color:#0f172a}
.theme-day .card{background:#fff;color:#0f172a}
.theme-night{background:#0f172a;color:#e5e7eb}
.theme-night .card{background:#1f2937;color:#e5e7eb}
.theme-special{background:#0b3a2b;color:#fff}
.theme-special .card{background:#0f4a33;color:#fefce8;border:1px solid rgba(212,175,55,.25)}
.tab-active{background:#1f2937;color:#f1f5f9}
.tab-inactive{background:#e5e7eb;color:#1f2937}

/* ====== Ù‡ÙŠØ¯Ø± Ø£ØµØºØ± ====== */
header#appHeader{
  padding:.6rem 1rem!important;
}
header #title{
  font-size:1rem; line-height:1.2;
}
#themeToggle{
  width:2.25rem;height:2.25rem;display:inline-flex;align-items:center;justify-content:center;
  border-radius:.65rem;
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø³Ø§Ø¹Ø© Ø£ØµØºØ± */
.clock-box{line-height:1.2;text-align:end;font-size:.85rem}
.clock-box .time{font-weight:700;font-variant-numeric:tabular-nums}

/* ====== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù‘Ù… ====== */
#progressBar{width:100%;height:6px;background:#e5e7eb;border-radius:999px;cursor:pointer}
#progressFill{height:100%;width:0;background:#10b981;border-radius:999px}

/* ====== Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆÙ‘Ø± ====== */
#imagesSection{background:#fff!important;color:#000!important;border-radius:12px;padding:10px}
#imageWrapper{
  /* Ù†Ø®Ù„ÙŠ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ ÙŠØ´ØªØºÙ„ Ø·Ø¨ÙŠØ¹ÙŠ Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù…Ø³Ù†Ø§ Ø§Ù„ØµÙˆØ±Ø© */
  touch-action: pan-y pinch-zoom;
  overflow:auto;    /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
  max-height: calc(100vh - 260px); /* Ø£ÙƒØ¨Ø± Ø§Ø±ØªÙØ§Ø¹ Ù…Ù…ÙƒÙ† Ø¨Ø¯ÙˆÙ† Ù…Ø§ ÙŠØ·Ù„Ø¨ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  border-radius: 10px;
  background: #fff;
}
/* Ø§Ù„ØµÙˆØ±Ø© Ù†ÙØ³Ù‡Ø§: Ù†Ù…Ù†Ø¹ ØªÙØ§Ø¹Ù„Ø§Øª Ù…Ø²Ø¹Ø¬Ø© (Ø§Ù„Ø²ÙˆÙ… Ø³Ù†Ù„ØºÙŠÙ‡ Ù…Ù† JS Ø£ÙŠØ¶Ø§Ù‹) */
#quranPage{
  display:block;margin:auto;
  background:#fff;padding:10px;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,.2);
  max-width:100%;
  height:auto;
  transform-origin:center center;
  transition:transform .2s ease;
  touch-action: manipulation; /* ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ù†Ù‚Ø± ÙˆØ§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø®ÙÙŠÙ Ø¨Ø¯ÙˆÙ† ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ */
  -webkit-user-drag: none;
  user-select: none;
}

/* ØªÙƒØ¨ÙŠØ± Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØµØ­Ù Ø¹Ù…ÙˆÙ…Ø§Ù‹ */
@media (min-width:768px){
  main{max-width:72rem}          /* Ø¨Ø¯Ù„ 4xl â†’ ØµØ§Ø± Ø£ÙƒØ¨Ø± */
}
@media (max-width:767px){
  /* Ù†Ø²ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØµÙˆØ±Ø© Ù„ØªØºÙ†ÙŠ Ø¹Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
  #imageWrapper{max-height: calc(100vh - 200px);}
}

/* âœ… fullscreen Ù…ØªÙ†Ø§Ø³Ù‚ Ø¹Ù„Ù‰ Ø¯ÙØ³ÙƒØªÙˆØ¨ ÙˆÙ…ÙˆØ¨Ø§ÙŠÙ„ */
#imageWrapper:fullscreen img{
  width:auto!important;height:100vh!important;max-width:100%;
  object-fit:contain!important;display:block;margin:auto
}
@supports (-webkit-touch-callout: none) {
  /* iOS ØªØ­Ø³ÙŠÙ†Ø§Øª Ø·ÙÙŠÙØ© */
  #imageWrapper:fullscreen img{height:100svh!important}
}

/* Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ø§Ø¦Ù… Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙ‚Ø· */
#whatsappFab{
  position:fixed; inset-inline-end:1rem; inset-block-end:1rem; z-index:50;
  width:3rem;height:3rem;border-radius:999px;background:#25D366;color:#fff;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 8px 24px rgba(0,0,0,.18);
}
#whatsappFab:hover{filter:brightness(1.08)}
</style>
</head>

<body class="theme-day min-h-screen">
<header id="appHeader" class="sticky top-0 z-10 border-b border-slate-200 flex items-center justify-between gap-3 backdrop-blur-md bg-white/60 dark:bg-slate-900/40">
  <div class="flex items-center gap-2">
    <button id="themeToggle" class="btn-gold" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ (Ù†Ù‡Ø§Ø±ÙŠ/Ù„ÙŠÙ„ÙŠ/Ø®Ø§Øµ)">
      <!-- Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ØªØªØºÙŠÙ‘Ø± Ù…Ù† JS -->
      <span id="themeIcon" aria-hidden="true">ğŸŒ</span>
    </button>
    <h1 id="title" class="font-bold">ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ <span class="font-normal">ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</span></h1>
  </div>
  <div class="flex flex-col items-end gap-0.5 pr-1">
    <div id="clockBox" class="clock-box">
      <!-- ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ù…Ù† JS: ØªØ§Ø±ÙŠØ® Ù‡Ø¬Ø±ÙŠ Ø¨Ø§Ø³Ù… Ø§Ù„Ø´Ù‡Ø± + Ù…ÙŠÙ„Ø§Ø¯ÙŠ + ÙˆÙ‚Øª 24h -->
      <!-- Ù…Ø«Ø§Ù„: 10 Ø±Ù…Ø¶Ø§Ù† 1446 Ù‡Ù€ | 18-03-2025 | 21:07 -->
    </div>
  </div>
</header>

<!-- Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¹Ø§Ø¦Ù… (Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙ‚Ø·) -->
<a id="whatsappFab" href="https://wa.me/905533331339" target="_blank" aria-label="Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨" title="ÙˆØ§ØªØ³Ø§Ø¨">
  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø³ÙŠØ·Ø© (Emoji)Ø› ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ù€SVG Ù„Ùˆ Ø­Ø§Ø¨ -->
  ğŸŸ¢
</a>

<!-- Tabs -->
<nav class="mx-auto p-4 flex gap-2" style="max-width:72rem">
  <button id="tabAudio" class="btn tab-active">ğŸ”Š Ø§Ù„ØµÙˆØª</button>
  <button id="tabImages" class="btn tab-inactive">ğŸ–¼ï¸ Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆÙ‘ÙØ±</button>
</nav>

<main class="mx-auto p-4 space-y-6" style="max-width:72rem">

  <!-- AUDIO SECTION -->
  <section id="audioSection" class="space-y-4">
    <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="card p-4">
        <h2 class="mb-2 font-semibold">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</h2>
        <select id="surahSelect" class="w-full p-2 rounded border text-black"></select>
      </div>
      <div class="card p-4">
        <h2 class="mb-2 font-semibold">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø±Ø¦</h2>
        <select id="reciterSelect" class="w-full p-2 rounded border text-black"></select>
      </div>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2">ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„</h2>
      <div class="flex flex-wrap items-center gap-4 text-sm">
        <label class="mr-1 inline-flex items-center gap-1">
          <input type="radio" name="mode" value="single" checked> Ù‚Ø§Ø±Ø¦ ÙˆØ§Ø­Ø¯
        </label>
        <label class="inline-flex items-center gap-1">
          <input type="radio" name="mode" value="multi"> Ø¹Ø¯Ø© Ù‚Ø±Ø§Ø¡
        </label>
        <label class="inline-flex items-center gap-1 ml-2">
          <input type="checkbox" id="loopToggle"> ØªÙƒØ±Ø§Ø± Ø§Ù„Ø³ÙˆØ±Ø©
        </label>
      </div>

      <div class="mt-3 flex flex-wrap gap-2 items-center text-sm">
        <label for="sleepMinutes">â±ï¸ Ù…Ø¤Ù‚Ù‘Øª Ø§Ù„Ù†ÙˆÙ…</label>
        <input id="sleepMinutes" type="number" min="1" step="1" placeholder="Ø¯Ù‚Ø§Ø¦Ù‚" class="w-20 p-1 border rounded text-black">
        <button id="sleepSet" class="px-3 py-1 bg-slate-600 text-white rounded">ØªÙØ¹ÙŠÙ„</button>
        <button id="sleepCancel" class="px-3 py-1 bg-red-500 text-white rounded">Ø¥Ù„ØºØ§Ø¡</button>
        <span id="sleepStatus" class="text-sm"></span>
      </div>
    </section>

    <section class="flex gap-3">
      <button id="addBtn" class="flex-1 btn btn-gold">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø´ØºÙ„</button>
      <button id="favBtn" class="flex-1 btn btn-ghost">â­ Ù…ÙØ¶Ù„Ø©</button>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2 flex items-center justify-between">
        <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</span>
        <button id="clearBtn" class="btn btn-danger text-sm">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </h2>
      <ul id="playlist" class="space-y-2"></ul>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2">Ø§Ù„Ù…Ø´ØºÙ‘Ù„</h2>
      <div id="playerBox"></div>
      <div id="progressBar" class="mt-2"><div id="progressFill"></div></div>
      <div class="flex items-center justify-center gap-2 mt-2">
        <button id="back10" class="btn">âª 10Ø«</button>
        <button id="playPause" class="btn">â¯ï¸ ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù</button>
        <button id="fwd10" class="btn">â© 10Ø«</button>
      </div>
      <div class="text-center mt-1 text-sm">
        <span id="timeNow">00:00</span> / <span id="timeTotal">00:00</span>
      </div>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2 flex items-center justify-between">
        <span>â­ Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>
        <button id="clearFavBtn" class="btn btn-danger text-sm">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </h2>
      <ul id="favorites" class="space-y-2"></ul>
    </section>
  </section>

  <!-- IMAGES SECTION -->
  <section id="imagesSection" class="space-y-4 hidden">
    <div class="card p-4">
      <h2 class="font-semibold mb-2">ğŸ“– Ø§Ù„Ù…ØµØ­Ù Ø¨Ø§Ù„ØµÙˆØ±</h2>

      <div class="mb-3">
        <label class="block mb-1 font-medium">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</label>
        <select id="surahImageSelect" class="w-full p-2 rounded border text-black"></select>
      </div>

      <div class="flex gap-3 mb-2 items-center">
        <button id="prevPage" class="btn">â¡ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <input id="pageNum" type="number" min="1" max="604" value="1" class="w-20 p-1 border rounded text-black">
        <span>/ 604</span>
        <button id="nextPage" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ â¬…</button>
      </div>

      <div id="imageWrapper">
        <img id="quranPage"
             src="https://easyquran.com/wp-content/uploads/2022/09/1-scaled.jpg"
             alt="ØµÙØ­Ø© Ø§Ù„Ù…ØµØ­Ù" loading="lazy">
      </div>

      <div class="flex justify-center mt-3">
        <button id="fullscreenBtn" class="btn btn-gold" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©">ğŸ“º</button>
      </div>
    </div>
  </section>

  <!-- â¬‡ï¸ Ø§Ù„Ø¯ÙØ¹Ø© 2 (Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª) Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
</main>
<script>
/* === Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© === */
const RECITERS=[
  {slug:"maher", name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ", base:"https://server12.mp3quran.net/maher"},
  {slug:"ajm", name:"Ø§Ù„Ø´ÙŠØ® Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ø¬Ù…ÙŠ", base:"https://server10.mp3quran.net/ajm"},
  {slug:"afs", name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ", base:"https://server8.mp3quran.net/afs"},
  {slug:"sgmd", name:"Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", base:"https://server7.mp3quran.net/s_gmd"},
  {slug:"shur", name:"Ø§Ù„Ø´ÙŠØ® Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…", base:"https://server7.mp3quran.net/shur"},
  {slug:"sds", name:"Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³", base:"https://server11.mp3quran.net/sds"},
];
const pad3=n=>String(n).padStart(3,"0");
let chapters=[];

const state={playlist:[],favorites:[],idx:0,mode:"single",loop:false,resume:{},sleepTimeout:null};
const THEMES=["day","night","special"];
let currentThemeIndex=0;

/* === ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ± Ù…Ù† API === */
async function fetchChapters(){
  try{
    const res=await fetch("https://api.quran.com/api/v4/chapters");
    const data=await res.json();
    chapters=data.chapters;
  }catch{
    chapters=[...Array(114)].map((_,i)=>({id:i+1,name_arabic:`Ø³ÙˆØ±Ø© ${i+1}`}));
  }
  document.getElementById("surahSelect").innerHTML=
    chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
  document.getElementById("reciterSelect").innerHTML=
    RECITERS.map(r=>`<option value="${r.slug}">${r.name}</option>`).join("");
  document.getElementById("surahImageSelect").innerHTML=
    `<option value="0">ğŸ“– ÙƒØ§Ù…Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù†</option>`+
    chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
}

/* === Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ ÙˆØ§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ === */
async function updateClock(){
  const now=new Date();
  const g=`${String(now.getDate()).padStart(2,"0")}-${String(now.getMonth()+1).padStart(2,"0")}-${now.getFullYear()}`;
  const t=`${String(now.getHours()).padStart(2,"0")}:${String(now.getMinutes()).padStart(2,"0")}`;
  try{
    const r=await fetch(`https://api.aladhan.com/v1/gToH?date=${g}`);
    const d=await r.json();
    const h=d.data.hijri;
    const hijriDate=`${h.day} ${h.month.ar} ${h.year} Ù‡Ù€`;
    document.getElementById("clockBox").innerHTML=`${hijriDate} | ${g} | <span class="time">${t}</span>`;
  }catch{
    document.getElementById("clockBox").innerHTML=`ğŸ“… ${g} | <span class="time">${t}</span>`;
  }
}
setInterval(updateClock,60000);
updateClock();

/* === Ø§Ù„Ø«ÙŠÙ…Ø§Øª === */
function applyTheme(t){
  document.body.classList.remove(...THEMES.map(x=>"theme-"+x));
  document.body.classList.add("theme-"+t);
  localStorage.setItem("theme_choice",t);
  document.getElementById("themeIcon").textContent=t==="day"?"ğŸŒ":t==="night"?"ğŸŒ™":"ğŸ’š";
}
function initTheme(){
  const s=localStorage.getItem("theme_choice");
  if(s){applyTheme(s);currentThemeIndex=THEMES.indexOf(s);}else{applyTheme("day");}
}
document.getElementById("themeToggle").onclick=()=>{
  currentThemeIndex=(currentThemeIndex+1)%THEMES.length;
  applyTheme(THEMES[currentThemeIndex]);
};

/* === Ø§Ù„ØµÙˆØª ÙˆØ§Ù„Ù…Ø´ØºÙ‘Ù„ === */
function persist(){
  localStorage.setItem("playlist",JSON.stringify(state.playlist));
  localStorage.setItem("favorites",JSON.stringify(state.favorites));
  localStorage.setItem("resume",JSON.stringify(state.resume));
}
function formatTime(s){
  if(!s||!isFinite(s))return"00:00";
  const m=Math.floor(s/60),sec=Math.floor(s%60);
  return`${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;
}
function render(auto=false){
  const cur=state.playlist[state.idx];
  const box=document.getElementById("playerBox");
  if(cur){
    box.innerHTML=`<div class="mb-2 font-medium">${cur.title} â€” <span class="text-emerald-500">${cur.reciter}</span></div>
      <audio id="player" src="${cur.src}" controls ${auto?"autoplay":""}></audio>`;
    const a=document.getElementById("player");
    a.loop=state.loop;
    a.onloadedmetadata=()=>{document.getElementById("timeTotal").textContent=formatTime(a.duration);if(state.resume[cur.src])a.currentTime=state.resume[cur.src];};
    a.ontimeupdate=()=>{updateProgress();state.resume[cur.src]=a.currentTime;persist();};
    a.onended=()=>{if(state.loop){a.currentTime=0;a.play();}else if(state.idx+1<state.playlist.length){state.idx++;render(true);}};
  }else box.innerHTML="<div class='text-slate-500'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ´ØºÙŠÙ„</div>";
  document.getElementById("playlist").innerHTML=state.playlist.map((t,i)=>`
    <li class="flex justify-between items-center bg-white/60 rounded px-3 py-2">
      <span>${t.title} - ${t.reciter}</span>
      <span>
        <button onclick="addFav(${i})" class="text-amber-500">â­</button>
        <button onclick="playAt(${i})">â–¶ï¸</button>
        <button onclick="removeAt(${i})" class="text-red-500">ğŸ—‘ï¸</button>
      </span>
    </li>`).join("");
}
function updateProgress(){
  const a=document.getElementById("player");
  if(!a||!isFinite(a.duration))return;
  document.getElementById("progressFill").style.width=(a.currentTime/a.duration*100)+"%";
  document.getElementById("timeNow").textContent=formatTime(a.currentTime);
}
document.getElementById("progressBar").onclick=e=>{
  const a=document.getElementById("player");if(!a||!isFinite(a.duration))return;
  const r=e.currentTarget.getBoundingClientRect();
  a.currentTime=((e.clientX-r.left)/r.width)*a.duration;
};
function add(auto=false){
  const recSlug=document.getElementById("reciterSelect").value;
  const rec=RECITERS.find(r=>r.slug===recSlug);
  const surId=parseInt(document.getElementById("surahSelect").value);
  if(!surId||!rec)return;
  if(state.mode==="single"&&state.playlist.length>0&&state.playlist[0].reciter!==rec.name){
    alert("âŒ ÙÙŠ ÙˆØ¶Ø¹ Ù‚Ø§Ø±Ø¦ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ù‚Ø§Ø±Ø¦.");return;
  }
  const sur=chapters.find(c=>c.id===surId);
  const newItem={title:sur.name_arabic,reciter:rec.name,src:`${rec.base}/${pad3(surId)}.mp3`};
  state.playlist.push(newItem);state.idx=state.playlist.length-1;persist();render(auto);
}
function playAt(i){state.idx=i;render(true);}
function removeAt(i){state.playlist.splice(i,1);if(state.idx>=state.playlist.length)state.idx=state.playlist.length-1;persist();render(false);}
function clearAll(){if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ØŸ")){state.playlist=[];state.idx=0;persist();render(false);}}
function togglePlay(){const a=document.getElementById("player");if(a)a.paused?a.play():a.pause();}
function skip(s){const a=document.getElementById("player");if(a)a.currentTime+=s;}
document.getElementById("addBtn").onclick=()=>add(true);
document.getElementById("back10").onclick=()=>skip(-10);
document.getElementById("fwd10").onclick=()=>skip(10);
document.getElementById("playPause").onclick=togglePlay;
document.getElementById("clearBtn").onclick=clearAll;
document.getElementById("loopToggle").onchange=e=>{state.loop=e.target.checked;const a=document.getElementById("player");if(a)a.loop=state.loop;};
document.querySelectorAll("input[name='mode']").forEach(r=>r.onchange=()=>state.mode=r.value);

/* === Ø§Ù„Ù…ÙØ¶Ù„Ø© === */
function addFav(i){
  const it=state.playlist[i];
  if(!it||state.favorites.some(f=>f.title===it.title&&f.reciter===it.reciter))return;
  state.favorites.push(it);persist();renderFav();
}
function addCurrentFav(){
  const cur=state.playlist[state.idx];
  if(!cur)return;
  if(!state.favorites.some(f=>f.title===cur.title&&f.reciter===cur.reciter)){state.favorites.push(cur);persist();renderFav();}
}
function renderFav(){
  document.getElementById("favorites").innerHTML=state.favorites.map((f,i)=>`
    <li class="flex justify-between"><span>${f.title} - ${f.reciter}</span>
    <button onclick="delFav(${i})" class="text-red-500">ğŸ—‘ï¸</button></li>`).join("");
}
function delFav(i){state.favorites.splice(i,1);persist();renderFav();}
function clearFav(){if(confirm("Ù…Ø³Ø­ Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ")){state.favorites=[];persist();renderFav();}}
document.getElementById("favBtn").onclick=addCurrentFav;
document.getElementById("clearFavBtn").onclick=clearFav;

/* === Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ… === */
function setSleep(){
  const min=parseInt(document.getElementById("sleepMinutes").value);
  if(isNaN(min)||min<=0)return alert("Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø¯Ù‚Ø§Ø¦Ù‚ ØµØ­ÙŠØ­");
  if(state.sleepTimeout)clearTimeout(state.sleepTimeout);
  state.sleepTimeout=setTimeout(()=>{
    const a=document.getElementById("player");
    if(a)a.pause();
    document.getElementById("sleepStatus").textContent="â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹";
  },min*60000);
  document.getElementById("sleepStatus").textContent=`Ø³ÙŠØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø¹Ø¯ ${min} Ø¯Ù‚ÙŠÙ‚Ø©`;
}
function cancelSleep(){
  if(state.sleepTimeout)clearTimeout(state.sleepTimeout);
  state.sleepTimeout=null;
  document.getElementById("sleepStatus").textContent="ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡";
}
document.getElementById("sleepSet").onclick=setSleep;
document.getElementById("sleepCancel").onclick=cancelSleep;

/* === Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª === */
const audioSec=document.getElementById("audioSection"),imgSec=document.getElementById("imagesSection");
document.getElementById("tabAudio").onclick=()=>{audioSec.classList.remove("hidden");imgSec.classList.add("hidden");};
document.getElementById("tabImages").onclick=()=>{imgSec.classList.remove("hidden");audioSec.classList.add("hidden");};

/* === Ø§Ù„Ù…ØµØ­Ù === */
const TOTAL_PAGES=604,img=document.getElementById("quranPage"),pageNum=document.getElementById("pageNum");
function loadPage(n){
  const p=Math.max(1,Math.min(TOTAL_PAGES,parseInt(n)||1));
  pageNum.value=p;
  img.src=`https://easyquran.com/wp-content/uploads/2022/09/${p}-scaled.jpg`;
}
document.getElementById("nextPage").onclick=()=>loadPage(parseInt(pageNum.value)+1);
document.getElementById("prevPage").onclick=()=>loadPage(parseInt(pageNum.value)-1);
pageNum.onchange=()=>loadPage(pageNum.value);

/* Ø³ÙˆØ±Ø© Ù„Ù„Ù…ØµØ­Ù */
const SURAH_PAGES={1:1,2:2,3:50,4:77,5:106,6:128,7:151,8:177,9:187,10:208,11:221,12:235,13:249,14:255,15:262,16:267,17:282,18:293,19:305,20:312,21:322,22:332,23:342,24:350,25:359,26:367,27:377,28:385,29:396,30:404,31:411,32:415,33:418,34:428,35:434,36:440,37:446,38:453,39:458,40:467,41:477,42:483,43:489,44:496,45:499,46:502,47:507,48:511,49:515,50:518,51:520,52:523,53:526,54:528,55:531,56:534,57:537,58:542,59:545,60:549,61:551,62:553,63:554,64:556,65:558,66:560,67:562,68:564,69:566,70:568,71:570,72:572,73:574,74:575,75:577,76:578,77:580,78:582,79:583,80:585,81:586,82:587,83:589,84:590,85:591,86:592,87:593,88:594,89:595,90:596,91:597,92:598,93:599,94:599,95:600,96:600,97:601,98:601,99:602,100:602,101:603,102:603,103:603,104:604,105:604,106:604,107:604,108:604,109:604,110:604,111:604,112:604,113:604,114:604};
document.getElementById("surahImageSelect").onchange=e=>{
  const id=parseInt(e.target.value);
  if(id===0)loadPage(1);else if(SURAH_PAGES[id])loadPage(SURAH_PAGES[id]);
};

/* Ø³Ø­Ø¨ ÙŠÙ…ÙŠÙ†/ÙŠØ³Ø§Ø± */
let startX=0;
img.addEventListener("touchstart",e=>{startX=e.changedTouches[0].screenX;});
img.addEventListener("touchend",e=>{
  const dx=e.changedTouches[0].screenX-startX;
  if(Math.abs(dx)>50){if(dx>0)loadPage(parseInt(pageNum.value)-1);else loadPage(parseInt(pageNum.value)+1);}
});

/* Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© */
const wrapper=document.getElementById("imageWrapper");
document.getElementById("fullscreenBtn").onclick=()=>{
  if(wrapper.requestFullscreen)wrapper.requestFullscreen();
  else if(wrapper.webkitRequestFullscreen)wrapper.webkitRequestFullscreen();
};
document.addEventListener("fullscreenchange",()=>{
  if(document.fullscreenElement){
    img.style.width="auto";img.style.height="100vh";img.style.objectFit="contain";
  }else{img.style.width="";img.style.height="";img.style.objectFit="";}
});

/* Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø© */
window.addEventListener("orientationchange",()=>{setTimeout(()=>{img.style.maxWidth="100%";img.style.height="auto";},400);});

/* === Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ === */
window.onload=()=>{
  initTheme();fetchChapters();updateClock();
  state.playlist=JSON.parse(localStorage.getItem("playlist")||"[]");
  state.favorites=JSON.parse(localStorage.getItem("favorites")||"[]");
  state.resume=JSON.parse(localStorage.getItem("resume")||"{}");
  render();renderFav();
};
</script>
