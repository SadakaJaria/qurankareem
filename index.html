<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--gold:#d4af37;}
body{font-family:"Noto Naskh Arabic UI","Segoe UI",system-ui,sans-serif;transition:background .4s,color .4s}
.card{border-radius:.75rem;box-shadow:0 4px 12px rgba(0,0,0,.12)}
#progressBar{width:100%;height:6px;background:#e5e7eb;border-radius:999px;cursor:pointer}
#progressFill{height:100%;width:0;background:#10b981;border-radius:999px}
.btn{padding:.4rem .8rem;border-radius:.65rem;font-weight:600}
.btn-small{padding:.3rem .6rem;font-size:.75rem;border-radius:.5rem}
.btn-gold{background:var(--gold);color:#1f2937}.btn-gold:hover{filter:brightness(1.05)}
.btn-danger{background:#ef4444;color:#fff}.btn-danger:hover{background:#dc2626}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,.15)}
.clock-box{text-align:center;line-height:1.4}
.clock-box .time{font-size:1.25rem;font-weight:600}
/* Themes */
.theme-day{background:#f8fafc;color:#0f172a}
.theme-day .card{background:#fff;color:#0f172a}
.theme-night{background:#111827;color:#f1f5f9}
.theme-night .card{background:#1f2937;color:#f1f5f9}
.theme-special{background:#0b3a2b;color:#fff}
.theme-special .card{background:#0f4a33;color:#fefce8;border:1px solid rgba(212,175,55,.25)}
.tab-active{background:#1f2937;color:#f1f5f9}
.tab-inactive{background:#eee;color:#1f2937}

/* ğŸ“– Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆØ± */
#imagesSection {
  background: #fff !important;
  color: #000 !important;
  border-radius: 12px;
  padding: 10px;
}
#imageWrapper { touch-action: none; overflow: hidden; }
#quranPage {
  background:#fff;
  padding:10px;
  border-radius:8px;
  box-shadow:0 2px 12px rgba(0,0,0,.2);
  max-width:100%;
  height:auto;
  transform-origin:center center;
  transition: transform 0.2s ease;
}
</style>
</head>
<body class="theme-day min-h-screen">
<header id="appHeader" class="sticky top-0 z-10 p-4 border-b border-slate-200 flex items-center justify-between gap-3 backdrop-blur-md">
<div class="flex items-center gap-3">
<button id="themeToggle" class="btn btn-gold text-sm">ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹</button>
<h1 class="text-lg font-bold">ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ <span class="font-normal">ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</span></h1>
</div>
<div class="flex flex-col items-end gap-1">
<div id="clockBox" class="clock-box text-sm"></div>
<a href="https://wa.me/905533331339" target="_blank" class="btn-small btn-gold">Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³ Ø§Ø¨</a>
</div>
</header>

<!-- Tabs -->
<nav class="max-w-4xl mx-auto p-4 flex gap-2">
<button id="tabAudio" class="btn tab-active">ğŸ”Š Ø§Ù„ØµÙˆØª</button>
<button id="tabImages" class="btn tab-inactive">ğŸ–¼ï¸ Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆÙ‘ÙØ±</button>
</nav>

<main class="max-w-4xl mx-auto p-4 space-y-6">

<!-- AUDIO SECTION -->
<section id="audioSection" class="space-y-4">
<section class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div class="card p-4">
<h2 class="mb-2 font-semibold">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</h2>
<select id="surahSelect" class="w-full p-2 rounded border text-black"></select>
</div>
<div class="card p-4">
<h2 class="mb-2 font-semibold">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø±Ø¦</h2>
<select id="reciterSelect" class="w-full p-2 rounded border text-black"></select>
</div>
</section>

<section class="card p-4">
<h2 class="font-semibold mb-2">ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„</h2>
<label class="mr-4"><input type="radio" name="mode" value="single" checked> Ù‚Ø§Ø±Ø¦ ÙˆØ§Ø­Ø¯</label>
<label><input type="radio" name="mode" value="multi"> Ø¹Ø¯Ø© Ù‚Ø±Ø§Ø¡</label>
<label class="ml-4"><input type="checkbox" id="loopToggle"> ØªÙƒØ±Ø§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</label>
<div class="mt-2 flex flex-wrap gap-2 items-center text-sm">
<label for="sleepMinutes">â±ï¸ Ù…Ø¤Ù‚Ù‘Øª Ø§Ù„Ù†ÙˆÙ…</label>
<input id="sleepMinutes" type="number" min="1" step="1" placeholder="Ø¯Ù‚Ø§Ø¦Ù‚" class="w-20 p-1 border rounded text-black">
<button id="sleepSet" class="px-3 py-1 bg-slate-600 text-white rounded">ØªÙØ¹ÙŠÙ„</button>
<button id="sleepCancel" class="px-3 py-1 bg-red-500 text-white rounded">Ø¥Ù„ØºØ§Ø¡</button>
<span id="sleepStatus" class="text-sm"></span>
</div>
</section>

<section class="flex gap-3">
<button id="addBtn" class="flex-1 btn btn-gold">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø´ØºÙ„</button>
<button id="favBtn" class="flex-1 btn btn-ghost">â­ Ù…ÙØ¶Ù„Ø©</button>
</section>

<section class="card p-4">
<h2 class="font-semibold mb-2 flex items-center justify-between">
<span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</span>
<button id="clearBtn" class="btn btn-danger text-sm">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</h2>
<ul id="playlist" class="space-y-2"></ul>
</section>

<section class="card p-4">
<h2 class="font-semibold mb-2">Ø§Ù„Ù…Ø´ØºÙ‘Ù„</h2>
<div id="playerBox"></div>
<div id="progressBar" class="mt-2"><div id="progressFill"></div></div>
<div class="flex items-center justify-center gap-2 mt-2">
<button id="back10" class="btn">âª 10Ø«</button>
<button id="playPause" class="btn">â¯ï¸ ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù</button>
<button id="fwd10" class="btn">â© 10Ø«</button>
</div>
<div class="text-center mt-1 text-sm">
<span id="timeNow">00:00</span> / <span id="timeTotal">00:00</span>
</div>
</section>

<section class="card p-4">
<h2 class="font-semibold mb-2 flex items-center justify-between">
<span>â­ Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>
<button id="clearFavBtn" class="btn btn-danger text-sm">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</h2>
<ul id="favorites" class="space-y-2"></ul>
</section>
</section>

<!-- IMAGES SECTION -->
<section id="imagesSection" class="space-y-4 hidden">
<div class="card p-4">
<h2 class="font-semibold mb-2">ğŸ“– Ø§Ù„Ù…ØµØ­Ù Ø¨Ø§Ù„ØµÙˆØ±</h2>

<!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø© ÙÙŠ Ø§Ù„ØµÙˆØ± -->
<div class="mb-3">
  <label class="block mb-1 font-medium">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</label>
  <select id="surahImageSelect" class="w-full p-2 rounded border text-black"></select>
</div>

<div class="flex gap-3 mb-2 items-center">
<button id="prevPage" class="btn">â¡ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
<input id="pageNum" type="number" min="1" max="604" value="1" class="w-20 p-1 border rounded text-black">
<span>/ 604</span>
<button id="nextPage" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ â¬…</button>
</div>

<div class="flex justify-center" id="imageWrapper">
  <img id="quranPage" src="images/000.png" alt="ØµÙØ­Ø© Ø§Ù„Ù…ØµØ­Ù">
</div>
<div class="flex justify-center mt-3">
  <button id="fullscreenBtn" class="btn btn-gold">ğŸ“º Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
</div>
</div>
</section>
</main>

<script>
// === Ø§Ù„Ù‚Ø±Ø§Ø¡ ===
const RECITERS=[
  {slug:"maher", name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ", base:"https://server12.mp3quran.net/maher"},
  {slug:"ajm", name:"Ø§Ù„Ø´ÙŠØ® Ø£Ø­Ù…Ø¯ Ø¨Ù† Ø¹Ù„ÙŠ Ø§Ù„Ø¹Ø¬Ù…ÙŠ", base:"https://server10.mp3quran.net/ajm"},
  {slug:"basit_mj", name:"Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯Ø§Ù„ØµÙ…Ø¯ (Ø§Ù„Ù…Ø¬ÙˆÙ‘Ø¯)", base:"https://server7.mp3quran.net/basit/Almusshaf-Al-Mojawwad"},
  {slug:"afs", name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø´Ø§Ø±ÙŠ Ø¨Ù† Ø±Ø§Ø´Ø¯ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ", base:"https://server8.mp3quran.net/afs"},
  {slug:"sgmd", name:"Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ", base:"https://server7.mp3quran.net/s_gmd"},
  {slug:"husr", name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø­Ù…ÙˆØ¯ Ø®Ù„ÙŠÙ„ Ø§Ù„Ø­ØµØ±ÙŠ", base:"https://server13.mp3quran.net/husr"},
  {slug:"shur", name:"Ø§Ù„Ø´ÙŠØ® Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…", base:"https://server7.mp3quran.net/shur"},
  {slug:"shatri", name:"Ø§Ù„Ø´ÙŠØ® Ø£Ø¨Ùˆ Ø¨ÙƒØ± Ø§Ù„Ø´Ø§Ø·Ø±ÙŠ", base:"https://server11.mp3quran.net/shatri"},
  {slug:"minsh", name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ", base:"https://server10.mp3quran.net/minsh"},
  {slug:"sds", name:"Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³", base:"https://server11.mp3quran.net/sds"}
];
const pad3=n=>String(n).padStart(3,"0");
let chapters=[];
const state={playlist:[],favorites:[],idx:0,mode:"single",loop:false,resume:{},sleepTimeout:null};
// === Ø®Ø±ÙŠØ·Ø© ØµÙØ­Ø§Øª Ø§Ù„Ø³ÙˆØ± Ù„Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆÙ‘ÙØ± ===
// (Ø§Ù„Ù‚ÙŠÙ… ØªÙ‚Ø±ÙŠØ¨ÙŠØ©: Ø¨Ø¯Ø§ÙŠØ© ÙƒÙ„ Ø³ÙˆØ±Ø© Ø¶Ù…Ù† 604 ØµÙØ­Ø©)
const SURAH_PAGES = {
  1: 1, 2: 2, 3: 50, 4: 77, 5: 106, 6: 128, 7: 151, 8: 177, 9: 187,
  10: 208, 11: 221, 12: 235, 13: 249, 14: 255, 15: 262, 16: 267,
  17: 282, 18: 293, 19: 305, 20: 312, 21: 322, 22: 332, 23: 342,
  24: 350, 25: 359, 26: 367, 27: 377, 28: 385, 29: 396, 30: 404,
  31: 411, 32: 415, 33: 418, 34: 428, 35: 434, 36: 440, 37: 446,
  38: 453, 39: 458, 40: 467, 41: 477, 42: 483, 43: 489, 44: 496,
  45: 499, 46: 502, 47: 507, 48: 511, 49: 515, 50: 518, 51: 520,
  52: 523, 53: 526, 54: 528, 55: 531, 56: 534, 57: 537, 58: 542,
  59: 545, 60: 549, 61: 551, 62: 553, 63: 554, 64: 556, 65: 558,
  66: 560, 67: 562, 68: 564, 69: 566, 70: 568, 71: 570, 72: 572,
  73: 574, 74: 575, 75: 577, 76: 578, 77: 580, 78: 582, 79: 583,
  80: 585, 81: 586, 82: 587, 83: 589, 84: 590, 85: 591, 86: 592,
  87: 593, 88: 594, 89: 595, 90: 596, 91: 597, 92: 598, 93: 599,
  94: 599, 95: 600, 96: 600, 97: 601, 98: 601, 99: 602, 100: 602,
  101: 603, 102: 603, 103: 603, 104: 604, 105: 604, 106: 604,
  107: 604, 108: 604, 109: 604, 110: 604, 111: 604, 112: 604,
  113: 604, 114: 604
};

// === Ø§Ù„Ø³ÙˆØ± (API + ØªØ¹Ø¨Ø¦Ø© select Ø§Ù„ØµÙˆØª + Ø§Ù„ØµÙˆØ±) ===
async function fetchChapters(){
  try{
    const r=await fetch("https://api.quran.com/api/v4/chapters");
    const j=await r.json();
    chapters=j.chapters||[];
  }catch(e){
    chapters=[...Array(114)].map((_,i)=>({id:i+1,name_arabic:`Ø³ÙˆØ±Ø© ${i+1}`}));
  }
  // Ø§Ù„ØµÙˆØª
  document.getElementById("surahSelect").innerHTML=chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
  document.getElementById("reciterSelect").innerHTML=RECITERS.map(r=>`<option value="${r.slug}">${r.name}</option>`).join("");

  // Ø§Ù„ØµÙˆØ±
  let surahImageSelect=document.getElementById("surahImageSelect");
  surahImageSelect.innerHTML=`<option value="0">ğŸ“– ÙƒØ§Ù…Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† (604 ØµÙØ­Ø©)</option>`+
    chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
}

// === Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ + Ø§Ù„Ù‡Ø¬Ø±ÙŠ ===
async function updateClock(){
  const d=new Date();
  const gDate=`${String(d.getDate()).padStart(2,"0")}-${String(d.getMonth()+1).padStart(2,"0")}-${d.getFullYear()}`;
  const t=`${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
  try {
    const resp = await fetch(`https://api.aladhan.com/v1/gToH?date=${gDate}`);
    const data = await resp.json();
    const hijriDate = data.data.hijri.date + " Ù‡Ù€";
    document.getElementById('clockBox').innerHTML=
      `<div>${hijriDate}</div><div>${gDate}</div><div class="time">${t}</div>`;
  } catch (e) {
    document.getElementById('clockBox').innerHTML=
      `<div>ğŸ“… ${gDate}</div><div class="time">${t}</div><div>(Ø§Ù„Ù‡Ø¬Ø±ÙŠ ØºÙŠØ± Ù…ØªØ§Ø­)</div>`;
  }
}
setInterval(updateClock,60000); updateClock();

// === Ø§Ù„Ø«ÙŠÙ…Ø§Øª ===
const THEMES=['day','night','special'];
let currentThemeIndex=0;
function applyTheme(t){
  document.body.classList.remove('theme-day','theme-night','theme-special');
  document.body.classList.add('theme-'+t);
  localStorage.setItem('theme_choice',t);
}
function autoPickTheme(){
  const h=(new Date()).getHours();
  applyTheme((h>=6&&h<19)?'day':'night');
}
function initTheme(){
  const saved=localStorage.getItem('theme_choice');
  if(saved){ applyTheme(saved); currentThemeIndex=THEMES.indexOf(saved); }
  else{ autoPickTheme(); currentThemeIndex=0; }
}
document.getElementById('themeToggle').onclick=()=>{
  currentThemeIndex=(currentThemeIndex+1)%THEMES.length;
  applyTheme(THEMES[currentThemeIndex]);
};
// === Player Functions ===
function add(auto=false){
  const recSlug=document.getElementById("reciterSelect").value;
  const rec=RECITERS.find(r=>r.slug===recSlug);
  const surId=parseInt(document.getElementById("surahSelect").value);
  if(!surId || !rec) return;
  const sur=chapters.find(c=>c.id===surId);
  const newItem={title:sur.name_arabic,reciter:rec.name,src:`${rec.base}/${pad3(surId)}.mp3`};
  if(state.mode==="single" && state.playlist.length>0 && state.playlist[0].reciter!==rec.name){ alert("ÙÙŠ ÙˆØ¶Ø¹ Ù‚Ø§Ø±Ø¦ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·."); return; }
  state.playlist.push(newItem); state.idx=state.playlist.length-1; persist(); render(auto);
}
function render(auto){
  const cur=state.playlist[state.idx];
  const box=document.getElementById("playerBox");
  if(cur){
    box.innerHTML=`<div class="mb-2 font-medium">${cur.title} â€” <span class="text-emerald-400">${cur.reciter}</span></div><audio id="player" src="${cur.src}" controls ${auto?'autoplay':''}></audio>`;
    const a=document.getElementById("player");
    a.loop=state.loop;
    a.ontimeupdate=()=>{updateProgress();state.resume[cur.src]=a.currentTime;localStorage.setItem("resume",JSON.stringify(state.resume));};
    a.onloadedmetadata=()=>{document.getElementById("timeTotal").textContent=formatTime(a.duration);if(state.resume[cur.src])a.currentTime=state.resume[cur.src];};
    a.onended=()=>{if(state.loop){a.currentTime=0;a.play();return;}if(state.idx+1<state.playlist.length){state.idx++;render(true);}};
  } else { box.innerHTML="<div class='text-slate-500'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ´ØºÙŠÙ„</div>"; }
  document.getElementById("playlist").innerHTML=state.playlist.map((t,i)=>`<li class="flex justify-between items-center gap-2 bg-white/60 rounded px-3 py-2"><span>${t.title} - ${t.reciter}</span><span><button onclick="addSpecificToFavorites(${i})" class="text-amber-500">â­</button><button onclick="playAt(${i})">â–¶ï¸</button><button onclick="removeAt(${i})" class="text-red-500">ğŸ—‘ï¸</button></span></li>`).join("");
}
function playAt(i){state.idx=i;render(true)}
function removeAt(i){state.playlist.splice(i,1); if(state.idx>=state.playlist.length) state.idx=state.playlist.length-1; persist(); render(false)}
function clearAll(){if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ØŸ")){state.playlist=[];state.idx=0;persist();render(false);}}
function togglePlay(){const a=document.getElementById("player");if(a)(a.paused?a.play():a.pause());}
function updateProgress(){const a=document.getElementById("player");if(!a||!isFinite(a.duration))return;document.getElementById("progressFill").style.width=(a.currentTime/a.duration*100)+"%";document.getElementById("timeNow").textContent=formatTime(a.currentTime);}
document.getElementById("progressBar").onclick=(e)=>{const a=document.getElementById("player");if(!a||!isFinite(a.duration))return;const rect=e.currentTarget.getBoundingClientRect();a.currentTime=((e.clientX-rect.left)/rect.width)*a.duration;};
function formatTime(s){if(!s||!isFinite(s))return"00:00";const m=Math.floor(s/60),sec=Math.floor(s%60);return`${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;}
function skip(sec){const a=document.getElementById("player");if(a)a.currentTime+=sec;}

// === Favorites ===
function addToFavorites(){const cur=state.playlist[state.idx];if(cur&&!state.favorites.some(f=>f.title===cur.title&&f.reciter===cur.reciter)){state.favorites.push(cur);persist();renderFavorites();}}
function addSpecificToFavorites(i){const it=state.playlist[i];if(!it) return;if(!state.favorites.some(f=>f.title===it.title&&f.reciter===it.reciter)){state.favorites.push(it);persist();renderFavorites();}}
function renderFavorites(){document.getElementById("favorites").innerHTML=state.favorites.map((f,i)=>`<li class="flex justify-between"><span>${f.title} - ${f.reciter}</span><button onclick="removeFav(${i})" class="text-red-500">ğŸ—‘ï¸</button></li>`).join("");}
function clearFavorites(){if(confirm("Ù…Ø³Ø­ Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ")){state.favorites=[];persist();renderFavorites();}}
function removeFav(i){state.favorites.splice(i,1);persist();renderFavorites();}

// === Sleep Timer ===
function setSleepTimer(){
  const min=parseInt(document.getElementById("sleepMinutes").value);
  if(isNaN(min)||min<=0)return alert("Ø£Ø¯Ø®Ù„ Ø¯Ù‚Ø§Ø¦Ù‚ ØµØ­ÙŠØ­Ø©");
  if(state.sleepTimeout)clearTimeout(state.sleepTimeout);
  state.sleepTimeout=setTimeout(()=>{
    const a=document.getElementById("player");
    if(a)a.pause();
    document.getElementById("sleepStatus").textContent="â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ´ØºÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹";
  },min*60000);
  document.getElementById("sleepStatus").textContent=`Ø³ÙŠØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø¹Ø¯ ${min} Ø¯Ù‚ÙŠÙ‚Ø©`;
}
function cancelSleepTimer(){
  if(state.sleepTimeout)clearTimeout(state.sleepTimeout);
  state.sleepTimeout=null;
  document.getElementById("sleepStatus").textContent="ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø¤Ù‚Ù‘Øª";
}

// === Tabs ===
const tabAudio=document.getElementById("tabAudio");
const tabImages=document.getElementById("tabImages");
const audioSection=document.getElementById("audioSection");
const imagesSection=document.getElementById("imagesSection");
function setTab(tab){
  if(tab==="audio"){
    tabAudio.classList.add("tab-active"); tabImages.classList.remove("tab-active");
    audioSection.classList.remove("hidden"); imagesSection.classList.add("hidden");
  } else {
    tabImages.classList.add("tab-active"); tabAudio.classList.remove("tab-active");
    imagesSection.classList.remove("hidden"); audioSection.classList.add("hidden");
  }
}
tabAudio.onclick=()=>setTab("audio");
tabImages.onclick=()=>setTab("images");

// === Images Viewer ===
const TOTAL_PAGES=604;
const imgEl=document.getElementById("quranPage");
const pageInput=document.getElementById("pageNum");
function loadPage(n){
  let p=Math.max(1,Math.min(TOTAL_PAGES,parseInt(n)||1));
  pageInput.value=p;
  imgEl.src="images/"+String(p).padStart(3,"0")+".png";
}
document.getElementById("nextPage").onclick=()=>loadPage(parseInt(pageInput.value)+1);
document.getElementById("prevPage").onclick=()=>loadPage(pageInput.value-1);
pageInput.onchange=()=>loadPage(pageInput.value);

// === Ø§Ø®ØªÙŠØ§Ø± Ø³ÙˆØ±Ø© Ù„Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆØ± ===
document.getElementById("surahImageSelect").onchange=(e)=>{
  let surahId=parseInt(e.target.value);
  if(surahId===0){ loadPage(1); }
  else if(SURAH_PAGES[surahId]){ loadPage(SURAH_PAGES[surahId]); }
};

// === Fullscreen Ù…Ø¹ Scroll ===
const fullscreenBtn=document.getElementById("fullscreenBtn");
const imageWrapper=document.getElementById("imageWrapper");
fullscreenBtn.onclick=()=>{
  if(imageWrapper.requestFullscreen) imageWrapper.requestFullscreen();
  else if(imageWrapper.webkitRequestFullscreen) imageWrapper.webkitRequestFullscreen();
  else if(imageWrapper.msRequestFullscreen) imageWrapper.msRequestFullscreen();
};
document.addEventListener("fullscreenchange",()=>{
  if(document.fullscreenElement){
    imgEl.style.maxHeight="none"; 
    imgEl.style.width="100%"; 
    imgEl.style.height="auto";
    imgEl.style.objectFit="contain"; 
  } else {
    imgEl.style.maxHeight=""; 
    imgEl.style.width=""; 
    imgEl.style.height=""; 
    imgEl.style.objectFit="";
  }
});

// === Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ ===
document.addEventListener("keydown",(e)=>{
  if(document.fullscreenElement){
    if(e.key==="ArrowRight"){ loadPage(parseInt(pageInput.value)+1); }
    if(e.key==="ArrowLeft"){ loadPage(pageInput.value-1); }
  }
});

// === Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„ÙŠÙ…ÙŠÙ†/Ø§Ù„ÙŠØ³Ø§Ø± (Ù…ØµØ­Ø­ Ø§Ù„Ø§ØªØ¬Ø§Ù‡) ===
let touchStartX=0;
imgEl.addEventListener("touchstart",(e)=>{
  touchStartX=e.changedTouches[0].screenX;
});
imgEl.addEventListener("touchend",(e)=>{
  let dx=e.changedTouches[0].screenX-touchStartX;
  if(Math.abs(dx)>50){
    if(dx>0){ 
      loadPage(parseInt(pageInput.value)+1); // ÙŠÙ…ÙŠÙ† = Ø§Ù„ØªØ§Ù„ÙŠ
    } else { 
      loadPage(pageInput.value-1);           // ÙŠØ³Ø§Ø± = Ø§Ù„Ø³Ø§Ø¨Ù‚
    }
  }
});
// === Pinch to Zoom ===
let scale=1;
let startDist=0;
imgEl.addEventListener("touchstart",(e)=>{
  if(e.touches.length===2){
    e.preventDefault();
    const dx=e.touches[0].clientX-e.touches[1].clientX;
    const dy=e.touches[0].clientY-e.touches[1].clientY;
    startDist=Math.sqrt(dx*dx+dy*dy);
  }
},{passive:false});
imgEl.addEventListener("touchmove",(e)=>{
  if(e.touches.length===2){
    e.preventDefault();
    const dx=e.touches[0].clientX-e.touches[1].clientX;
    const dy=e.touches[0].clientY-e.touches[1].clientY;
    const newDist=Math.sqrt(dx*dx+dy*dy);
    const factor=newDist/startDist;
    const newScale=Math.min(3,Math.max(1,scale*factor));
    imgEl.style.transform=`scale(${newScale})`;
  }
},{passive:false});
imgEl.addEventListener("touchend",(e)=>{
  if(e.touches.length<2){
    scale=parseFloat(imgEl.style.transform.replace(/[^0-9.]/g,""))||1;
  }
});

// === Init ===
function persist(){
  localStorage.setItem("playlist",JSON.stringify(state.playlist));
  localStorage.setItem("favorites",JSON.stringify(state.favorites));
  localStorage.setItem("resume",JSON.stringify(state.resume));
}
function setupUI(){
  document.getElementById("addBtn").onclick=()=>add(true);
  document.getElementById("favBtn").onclick=addToFavorites;
  document.getElementById("clearBtn").onclick=clearAll;
  document.getElementById("clearFavBtn").onclick=clearFavorites;
  document.getElementById("back10").onclick=()=>skip(-10);
  document.getElementById("fwd10").onclick=()=>skip(10);
  document.getElementById("playPause").onclick=togglePlay;
  document.getElementById("sleepSet").onclick=setSleepTimer;
  document.getElementById("sleepCancel").onclick=cancelSleepTimer;
  document.getElementById("loopToggle").onchange=e=>{
    state.loop=e.target.checked;
    const a=document.getElementById("player");if(a)a.loop=state.loop;
  };
  document.querySelectorAll("input[name='mode']").forEach(r=>r.onchange=()=>state.mode=r.value);
}
window.onload=()=>{
  initTheme();fetchChapters();updateClock();
  state.playlist=JSON.parse(localStorage.getItem("playlist")||"[]");
  state.favorites=JSON.parse(localStorage.getItem("favorites")||"[]");
  state.resume=JSON.parse(localStorage.getItem("resume")||"{}");
  setupUI();render(false);renderFavorites();
};
</script>
</body>
</html>
