<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>📖 القرآن الكريم – صدقة جارية</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{
  --gold:#d4af37;
  --ink:#0f172a;
  --paper:#ffffff;
  --soft:#f1f5f9;
}

/* أساس */
body{
  font-family:"Noto Naskh Arabic UI","Segoe UI",system-ui,sans-serif;
  transition:background .25s,color .25s;
}

/* بطاقات وأزرار */
.card{border-radius:.75rem;box-shadow:0 4px 12px rgba(0,0,0,.1)}
.btn{padding:.4rem .75rem;border-radius:.6rem;font-weight:600}
.btn-gold{background:var(--gold);color:#1f2937}
.btn-danger{background:#ef4444;color:#fff}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,.15)}
.btn-contrast{background:#f1f5f9;color:#0f172a;border:1px solid #cbd5e1}

/* الثيمات */
.theme-day{background:#f8fafc;color:#0f172a}
.theme-day .card{background:#ffffff;color:#0f172a}
.theme-night{background:#0f172a;color:#e5e7eb}
.theme-night .card{background:#111827;color:#e5e7eb}
.theme-special{background:#0b3a2b;color:#fefce8}
.theme-special .card{background:#0f4a33;color:#fefce8;border:1px solid rgba(212,175,55,.25)}

/* الهيدر (شفاف) */
header#appHeader{padding:1rem;background:transparent}
#themeToggle{
  width:2.3rem;height:2.3rem;display:flex;align-items:center;justify-content:center;
  border-radius:.65rem;background:var(--gold);color:#1f2937
}
.clock-box{text-align:end;line-height:1.25}
.clock-box div{font-size:.9rem}

/* تبويبات: النص أسود دائمًا */
nav.top-tabs{max-width:80rem;margin:auto}
.top-tabs .btn{border-radius:1.1rem;padding:.5rem 1rem}
.tab-active{background:#eef2f7;color:#000;border:1px solid #cbd5e1}
.tab-inactive{background:transparent;color:#000;border:1px solid #cbd5e1;opacity:.8}

/* واتساب (الأيقونة الجديدة) */
#whatsappFab{
  position:fixed;inset-inline-end:1rem;inset-block-end:1rem;z-index:50;
  width:3rem;height:3rem;border-radius:999px;background:#25D366;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 8px 20px rgba(0,0,0,.25)
}
#whatsappFab img{width:1.9rem;height:1.9rem}

/* المصحف المصوّر */
.quran-controls{
  display:flex;flex-wrap:wrap;align-items:center;gap:.4rem;
  padding:.35rem .55rem;             /* أقصر بالطول */
  border-radius:8px;background:#eef2f7;color:#0b1423;border:1px solid #dbe3ee;
}
.quran-controls select{
  padding:.34rem .5rem;border-radius:8px;border:1px solid #cbd5e1;background:#fff;color:#0b1423
}
.quran-controls .btn-tv{background:var(--gold);color:#1f2937;padding:.34rem .6rem;border-radius:.5rem}

.quran-stage{ background:#e8edf5;border-radius:10px;padding:.4rem; }
#imageWrapper{
  width:100%;
  height:calc(100vh - 165px);       /* مساحة قراءة أكبر */
  overflow:auto;display:flex;align-items:center;justify-content:center;
  background:#fff;border-radius:8px;scroll-behavior:smooth;touch-action:pan-y;
}
#quranPage{
  display:block;max-width:100%;max-height:100%;height:auto;margin:auto;
  border-radius:6px;user-select:none;-webkit-user-drag:none;
  box-shadow:0 2px 10px rgba(0,0,0,.12);
}
#imageWrapper:fullscreen img{width:auto!important;height:100vh!important;object-fit:contain}

/* الصوت */
.sleep-row input{
  width:4.8rem;padding:.32rem;border-radius:.5rem;border:1px solid #cbd5e1;background:#fff;color:#0b1423
}

/* موبايل */
@media (max-width:640px){
  .quran-controls{gap:.3rem;padding:.3rem .5rem}
  #imageWrapper{height:calc(100dvh - 140px)}
  #whatsappFab{inset-inline-end:.75rem;inset-block-end:.75rem}
}
</style>
</head>

<body class="theme-day min-h-screen">
<header id="appHeader" class="sticky top-0 z-10 border-b border-[#dbe3ee] flex items-center justify-between gap-3 backdrop-blur-md">
  <div class="flex items-center gap-2">
    <button id="themeToggle" title="تبديل الوضع"><span id="themeIcon">🌞</span></button>
    <h1 class="font-bold text-base sm:text-lg">📖 القرآن الكريم – <span class="font-normal">صدقة جارية</span></h1>
  </div>
  <div class="clock-box">
    <div id="hijriLine">—</div>
    <div id="gregLine">—</div>
  </div>
</header>

<!-- زر واتساب -->
<a id="whatsappFab" href="https://wa.me/905533331339" target="_blank" title="واتساب">
  <img src="https://i.imgur.com/XC8wuji.png" alt="WhatsApp">
</a>

<!-- Tabs -->
<nav class="top-tabs p-4 flex gap-2">
  <button id="tabAudio" class="btn tab-inactive">الصوت 🔊</button>
  <button id="tabImages" class="btn tab-active">المصحف المصوّر 🖼️</button>
</nav>

<main class="space-y-6">

  <!-- المصحف المصوّر (بدون أزرار “السابق/التالي”) -->
  <section id="imagesSection" class="space-y-3">
    <div class="card p-3">
      <h2 class="font-semibold mb-2">📖 المصحف المصوّر</h2>

      <!-- شريط أدوات صغير -->
      <div class="quran-controls">
        <label class="opacity-80 text-sm">السورة:</label>
        <select id="surahImageSelect" class="text-black"></select>

        <div class="flex items-center gap-2 ms-auto">
          <div class="flex items-center gap-1">
            <input id="pageNum" type="number" min="1" max="604" value="1" class="w-20 p-1 rounded border text-black bg-white">
            <span>/ 604</span>
          </div>
          <button id="fullscreenBtn" class="btn btn-tv" title="ملء الشاشة">📺</button>
        </div>
      </div>

      <!-- المسرح (مساحة القراءة الكبيرة) -->
      <div class="quran-stage">
        <div id="imageWrapper">
          <img id="quranPage"
               src="https://easyquran.com/wp-content/uploads/2022/09/1-scaled.jpg"
               alt="صفحة المصحف" loading="lazy">
        </div>
      </div>
    </div>
  </section>

  <!-- الصوت -->
  <section id="audioSection" class="hidden space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="card p-4">
        <h2 class="mb-2 font-semibold">اختيار السورة</h2>
        <select id="surahSelect" class="w-full p-2 rounded border text-black"></select>
      </div>
      <div class="card p-4">
        <h2 class="mb-2 font-semibold">اختيار القارئ</h2>
        <select id="reciterSelect" class="w-full p-2 rounded border text-black"></select>
      </div>
    </div>

    <div class="card p-4">
      <h2 class="font-semibold mb-2">وضع التشغيل</h2>
      <div class="flex flex-wrap items-center gap-4 text-sm">
        <label><input type="radio" name="mode" value="single" checked> قارئ واحد</label>
        <label><input type="radio" name="mode" value="multi"> عدة قراء</label>
        <label><input type="checkbox" id="loopToggle"> تكرار السورة</label>
      </div>

      <!-- مؤقت النوم: إدخال بالدقائق (العدّ التنازلي يظهر لاحقًا عبر JS) -->
      <div class="mt-3 flex flex-wrap gap-2 items-center text-sm sleep-row">
        <label>⏱️ مؤقّت النوم</label>
        <input id="sleepMinutes" type="number" min="0" step="1" placeholder="دقائق">
        <button id="sleepSet" class="px-3 py-1 bg-slate-600 text-white rounded">تفعيل</button>
        <button id="sleepCancel" class="px-3 py-1 bg-red-500 text-white rounded">إلغاء</button>
        <span id="sleepStatus" class="text-sm"></span>
      </div>
    </div>

    <div class="flex gap-3">
      <button id="addBtn" class="flex-1 btn btn-gold">➕ إضافة للمشغل</button>
      <button id="favBtn" class="flex-1 btn btn-ghost">⭐ مفضلة</button>
    </div>

    <div class="card p-4">
      <h2 class="font-semibold mb-2 flex items-center justify-between">
        <span>قائمة التشغيل</span>
        <button id="clearBtn" class="btn btn-danger text-sm">🗑️ مسح الكل</button>
      </h2>
      <ul id="playlist" class="space-y-2"></ul>
    </div>

    <div class="card p-4">
      <h2 class="font-semibold mb-2">المشغّل</h2>
      <div id="playerBox"></div>
      <div id="progressBar" class="mt-2 bg-gray-200 rounded-full h-2">
        <div id="progressFill" class="h-2 bg-emerald-500 rounded-full w-0"></div>
      </div>
      <div class="flex items-center justify-center gap-2 mt-2">
        <button id="back10" class="btn btn-contrast">⏪ 10ث</button>
        <button id="playPause" class="btn btn-contrast">⏯️ تشغيل/إيقاف</button>
        <button id="fwd10" class="btn btn-contrast">⏩ 10ث</button>
      </div>
      <div class="text-center mt-1 text-sm">
        <span id="timeNow">00:00</span> / <span id="timeTotal">00:00</span>
      </div>
    </div>

    <div class="card p-4">
      <h2 class="font-semibold mb-2 flex items-center justify-between">
        <span>⭐ المفضلة</span>
        <button id="clearFavBtn" class="btn btn-danger text-sm">🗑️ مسح الكل</button>
      </h2>
      <ul id="favorites" class="space-y-2"></ul>
    </div>
  </section>

<!-- 🔽🔽 هنا لصق الدفعة 2 (JavaScript) 🔽🔽 -->

</main>
<script>
/* === أدوات سريعة === */
const $ = id => document.getElementById(id);
const pad3 = n => String(n).padStart(3,"0");

/* === الثيمات === */
const THEMES = ["day","night","special"];
let currentThemeIndex = 0;
function applyTheme(theme){
  document.body.classList.remove("theme-day","theme-night","theme-special");
  document.body.classList.add("theme-"+theme);
  $("themeIcon").textContent = theme==="day"?"🌞":theme==="night"?"🌙":"💚";
  localStorage.setItem("theme_choice", theme);
}
function initTheme(){
  const saved = localStorage.getItem("theme_choice");
  if(saved && THEMES.includes(saved)){
    applyTheme(saved);
    currentThemeIndex = THEMES.indexOf(saved);
  } else applyTheme("day");
}
$("themeToggle").onclick = ()=>{
  currentThemeIndex = (currentThemeIndex+1)%THEMES.length;
  applyTheme(THEMES[currentThemeIndex]);
};

/* === الساعة والتاريخ === */
async function updateClock(){
  const d=new Date();
  const gDate=`${String(d.getDate()).padStart(2,"0")}-${String(d.getMonth()+1).padStart(2,"0")}-${d.getFullYear()}`;
  const t=`${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
  try{
    const r=await fetch(`https://api.aladhan.com/v1/gToH?date=${gDate}`);
    const j=await r.json();
    $("hijriLine").textContent = `${j.data.hijri.day} ${j.data.hijri.month.ar} ${j.data.hijri.year} هـ`;
    $("gregLine").textContent = `${gDate} | ${t}`;
  }catch{
    $("hijriLine").textContent = "—";
    $("gregLine").textContent = `${gDate} | ${t}`;
  }
}
setInterval(updateClock,60000);

/* === التبويبات === */
function setTab(tab){
  const a=$("tabAudio"), i=$("tabImages");
  if(tab==="audio"){
    a.classList.add("tab-active"); a.classList.remove("tab-inactive");
    i.classList.add("tab-inactive"); i.classList.remove("tab-active");
    $("audioSection").classList.remove("hidden");
    $("imagesSection").classList.add("hidden");
  }else{
    i.classList.add("tab-active"); i.classList.remove("tab-inactive");
    a.classList.add("tab-inactive"); a.classList.remove("tab-active");
    $("imagesSection").classList.remove("hidden");
    $("audioSection").classList.add("hidden");
  }
}
$("tabAudio").onclick=()=>setTab("audio");
$("tabImages").onclick=()=>setTab("images");

/* === القُرّاء والسور === */
const RECITERS=[
  {slug:"maher",name:"الشيخ ماهر المعيقلي",base:"https://server12.mp3quran.net/maher"},
  {slug:"ajm",name:"الشيخ أحمد بن علي العجمي",base:"https://server10.mp3quran.net/ajm"},
  {slug:"afs",name:"الشيخ مشاري العفاسي",base:"https://server8.mp3quran.net/afs"},
  {slug:"sds",name:"الشيخ عبدالرحمن السديس",base:"https://server11.mp3quran.net/sds"},
  {slug:"shur",name:"الشيخ سعود الشريم",base:"https://server7.mp3quran.net/shur"},
  {slug:"sgmd",name:"الشيخ سعد الغامدي",base:"https://server7.mp3quran.net/s_gmd"},
  {slug:"minsh",name:"الشيخ محمد صديق المنشاوي",base:"https://server10.mp3quran.net/minsh"},
  {slug:"husr",name:"الشيخ محمود خليل الحصري",base:"https://server13.mp3quran.net/husr"},
  {slug:"basit_mj",name:"الشيخ عبدالباسط (المجوّد)",base:"https://server7.mp3quran.net/basit/Almusshaf-Al-Mojawwad"},
  {slug:"shatri",name:"الشيخ أبو بكر الشاطري",base:"https://server11.mp3quran.net/shatri"}
];
let chapters=[];
async function fetchChapters(){
  try{
    const r=await fetch("https://api.quran.com/api/v4/chapters");
    const j=await r.json(); chapters=j.chapters||[];
  }catch{ chapters=[...Array(114)].map((_,i)=>({id:i+1,name_arabic:`سورة ${i+1}`})); }
  $("surahSelect").innerHTML = chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
  $("reciterSelect").innerHTML = RECITERS.map(r=>`<option value="${r.slug}">${r.name}</option>`).join("");
  $("surahImageSelect").innerHTML = `<option value="0">📖 كامل القرآن</option>` + chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
}

/* === الصوت === */
const state={playlist:[],favorites:[],idx:0,mode:"single",loop:false,resume:{},sleepTimeout:null,sleepTicker:null};
function formatTime(s){if(!s||!isFinite(s))return"00:00";let m=Math.floor(s/60),sec=Math.floor(s%60);return`${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;}
function persist(){localStorage.setItem("playlist",JSON.stringify(state.playlist));localStorage.setItem("favorites",JSON.stringify(state.favorites));}
function render(auto=false){
  const cur=state.playlist[state.idx]; const box=$("playerBox");
  if(cur){
    box.innerHTML=`<div>${cur.title} - <span class='text-emerald-500'>${cur.reciter}</span></div><audio id='player' src='${cur.src}' controls ${auto?'autoplay':''}></audio>`;
    const a=$("player");
    a.loop=state.loop;
    a.ontimeupdate=()=>{if(a.duration){$("progressFill").style.width=(a.currentTime/a.duration*100)+"%";$("timeNow").textContent=formatTime(a.currentTime);}};
    a.onloadedmetadata=()=>$("timeTotal").textContent=formatTime(a.duration);
    a.onended=()=>{if(state.loop)a.play();else if(state.idx+1<state.playlist.length){state.idx++;render(true);}};
  }else box.innerHTML="<div class='text-slate-400'>لا يوجد تشغيل</div>";
  $("playlist").innerHTML=state.playlist.map((t,i)=>`<li class='flex justify-between bg-white/60 rounded px-3 py-2'><span>${t.title} - ${t.reciter}</span><span><button onclick='playAt(${i})'>▶️</button><button onclick='favFromIdx(${i})'>⭐</button><button onclick='delAt(${i})'>🗑️</button></span></li>`).join("");
  $("favorites").innerHTML=state.favorites.map((f,i)=>`<li class='flex justify-between bg-white/60 rounded px-3 py-2'><span>${f.title} - ${f.reciter}</span><button onclick='delFav(${i})'>🗑️</button></li>`).join("");
  persist();
}
function addToPlaylist(auto=false){
  const recSlug=$("reciterSelect").value, surId=+($("surahSelect").value);
  const rec=RECITERS.find(r=>r.slug===recSlug); if(!rec||!surId)return;
  if(state.mode==="single"&&state.playlist.length>0&&state.playlist[0].reciter!==rec.name)return alert("وضع قارئ واحد: لا يمكن خلط القراء");
  const sur=chapters.find(c=>c.id===surId)||{name_arabic:`سورة ${surId}`};
  state.playlist.push({title:sur.name_arabic,reciter:rec.name,src:`${rec.base}/${pad3(surId)}.mp3`});
  state.idx=state.playlist.length-1; render(auto);
}
function playAt(i){state.idx=i;render(true);}
function delAt(i){state.playlist.splice(i,1);state.idx=Math.max(0,state.playlist.length-1);render(false);}
function favFromIdx(i){const it=state.playlist[i];if(it&&!state.favorites.find(f=>f.src===it.src)){state.favorites.push(it);render();}}
function delFav(i){state.favorites.splice(i,1);render();}
$("addBtn").onclick=()=>addToPlaylist(true);
$("favBtn").onclick=()=>{const cur=state.playlist[state.idx];if(cur&&!state.favorites.find(f=>f.src===cur.src)){state.favorites.push(cur);render();}};
$("clearBtn").onclick=()=>{if(confirm("مسح الكل؟")){state.playlist=[];state.idx=0;render();}};
$("clearFavBtn").onclick=()=>{if(confirm("مسح المفضلة؟")){state.favorites=[];render();}};
$("loopToggle").onchange=e=>{state.loop=e.target.checked;};

/* مؤقّت النوم */
$("sleepSet").onclick=()=>{
  const min=parseInt($("sleepMinutes").value)||0;if(min<=0)return alert("أدخل مدة صحيحة");
  if(state.sleepTimeout)clearTimeout(state.sleepTimeout);if(state.sleepTicker)clearInterval(state.sleepTicker);
  const a=$("player");const end=Date.now()+min*60000;
  state.sleepTicker=setInterval(()=>{const r=Math.max(0,end-Date.now()),s=Math.ceil(r/1000),mm=Math.floor(s/60),ss=s%60;$("sleepStatus").textContent=`إيقاف بعد ${String(mm).padStart(2,"0")}:${String(ss).padStart(2,"0")}`;},1000);
  state.sleepTimeout=setTimeout(()=>{if(a)a.pause();$("sleepStatus").textContent="⏹️ تم الإيقاف";clearInterval(state.sleepTicker);},min*60000);
};
$("sleepCancel").onclick=()=>{if(state.sleepTimeout)clearTimeout(state.sleepTimeout);if(state.sleepTicker)clearInterval(state.sleepTicker);$("sleepStatus").textContent="تم الإلغاء";};

/* === المصحف المصوّر === */
const TOTAL_PAGES=604;
const SURAH_PAGES={1:1,2:2,3:50,4:77,5:106,6:128,7:151,8:177,9:187,10:208,11:221,12:235,13:249,14:255,15:262,16:267,17:282,18:293,19:305,20:312,21:322,22:332,23:342,24:350,25:359,26:367,27:377,28:385,29:396,30:404,31:411,32:415,33:418,34:428,35:434,36:440,37:446,38:453,39:458,40:467,41:477,42:483,43:489,44:496,45:499,46:502,47:507,48:511,49:515,50:518,51:520,52:523,53:526,54:528,55:531,56:534,57:537,58:542,59:545,60:549,61:551,62:553,63:554,64:556,65:558,66:560,67:562,68:564,69:566,70:568,71:570,72:572,73:574,74:575,75:577,76:578,77:580,78:582,79:583,80:585,81:586,82:587,83:589,84:590,85:591,86:592,87:593,88:594,89:595,90:596,91:597,92:598,93:599,94:599,95:600,96:600,97:601,98:601,99:602,100:602,101:603,102:603,103:603,104:604,105:604,106:604,107:604,108:604,109:604,110:604,111:604,112:604,113:604,114:604};
const BASE="https://easyquran.com/wp-content/uploads/2022/09/";
const img=$("quranPage"),input=$("pageNum"),wrap=$("imageWrapper");
function loadPage(n){let p=Math.max(1,Math.min(TOTAL_PAGES,+n||1));input.value=p;img.src=`${BASE}${p}-scaled.jpg`;}
$("surahImageSelect").onchange=e=>{const id=+e.target.value;if(id===0)loadPage(1);else if(SURAH_PAGES[id])loadPage(SURAH_PAGES[id]);};
let startX=0;img.addEventListener("touchstart",e=>{startX=e.touches[0].clientX;});img.addEventListener("touchend",e=>{let dx=e.changedTouches[0].clientX-startX;if(Math.abs(dx)>60){if(dx>0)loadPage(+input.value+1);else loadPage(+input.value-1);}});wrap.addEventListener("wheel",e=>{if(e.deltaY>0)loadPage(+input.value+1);else loadPage(+input.value-1);});
document.addEventListener("keydown",e=>{if(document.fullscreenElement){if(e.key==="ArrowRight")loadPage(+input.value+1);if(e.key==="ArrowLeft")loadPage(+input.value-1);}});
$("fullscreenBtn").onclick=()=>wrap.requestFullscreen&&wrap.requestFullscreen();

/* === التشغيل الأول === */
window.addEventListener("DOMContentLoaded",()=>{
  initTheme();updateClock();fetchChapters();
  state.playlist=JSON.parse(localStorage.getItem("playlist")||"[]");
  state.favorites=JSON.parse(localStorage.getItem("favorites")||"[]");
  render(false);loadPage(1);
  setTab("images");
});
</script>
</body>
</html>
