<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root{--gold:#d4af37;}
body{
  font-family:"Noto Naskh Arabic UI","Segoe UI",system-ui,sans-serif;
  transition:background .25s,color .25s;
}
.card{border-radius:.75rem;box-shadow:0 4px 12px rgba(0,0,0,.12)}
.btn{padding:.45rem .9rem;border-radius:.65rem;font-weight:600}
.btn-ghost{background:transparent;border:1px solid rgba(0,0,0,.15)}
.btn-gold{background:var(--gold);color:#1f2937}.btn-gold:hover{filter:brightness(1.05)}
.btn-danger{background:#ef4444;color:#fff}.btn-danger:hover{background:#dc2626}

/* ===== Ø§Ù„Ø«ÙŠÙ…Ø§Øª ===== */
.theme-day{background:#f8fafc;color:#0f172a}
.theme-day .card{background:#fff;color:#0f172a}
.theme-night{background:#0f172a;color:#e5e7eb}
.theme-night .card{background:#1f2937;color:#e5e7eb}
.theme-special{background:#0b3a2b;color:#fff}
.theme-special .card{background:#0f4a33;color:#fefce8;border:1px solid rgba(212,175,55,.25)}
.tab-active{background:#1f2937;color:#f1f5f9}
.tab-inactive{background:#e5e7eb;color:#1f2937}

/* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± (Ø£ÙƒØ¨Ø± 20% + Ø´ÙØ§Ù) ===== */
header#appHeader{
  padding:1rem 1.2rem;
  background:transparent;
}
#themeToggle{
  width:2.4rem;height:2.4rem;display:inline-flex;align-items:center;justify-content:center;
  border-radius:.65rem;background:var(--gold);color:#1f2937;
}
#title{font-size:1.05rem;line-height:1.25}
.clock-box{line-height:1.2;text-align:end;font-size:.9rem}
.clock-box .hijri{font-weight:700}
.clock-box .greg{font-variant-numeric:tabular-nums;opacity:.9}

/* ===== ÙˆØ§ØªØ³Ø§Ø¨ ===== */
#whatsappFab{
  position:fixed;inset-inline-end:1rem;inset-block-end:1rem;z-index:50;
  width:3.2rem;height:3.2rem;border-radius:999px;background:#25D366;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 10px 24px rgba(0,0,0,.18);
}
#whatsappFab img{width:1.75rem;height:1.75rem;display:block}
#whatsappFab:hover{filter:brightness(1.08)}

/* ===== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ===== */
nav.top-tabs{max-width:80rem;margin-inline:auto}

/* ===== Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆØ± ===== */
#imagesSection{
  background:#fff!important;color:#000!important;border-radius:12px;padding:10px;
}
.quran-controls{
  display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;
  gap:.5rem;margin-bottom:.5rem;padding:.3rem .6rem;
  background:#f9fafb;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.08);
}
.quran-controls select{padding:.3rem .5rem;border-radius:6px}
.quran-controls .btn{padding:.3rem .6rem;font-size:.85rem}

#imageWrapper{
  width:100%;height:auto;max-height:calc(100vh - 140px);
  overflow:auto;display:flex;align-items:center;justify-content:center;
  border-radius:10px;background:#fff;touch-action:pan-y;
}
#quranPage{
  display:block;max-width:100%;height:auto;margin:auto;
  background:#fff;border-radius:8px;
  box-shadow:0 2px 10px rgba(0,0,0,.15);
  user-select:none;-webkit-user-drag:none;
}

/* ===== Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© ===== */
#imageWrapper:fullscreen img{
  width:auto!important;height:100vh!important;max-width:100%;
  object-fit:contain!important;display:block;margin:auto;
}

/* ===== Ø¹Ø§Ù… ===== */
main{max-width:80rem;margin:auto;padding:1rem;}
</style>
</head>

<body class="theme-day min-h-screen">
<header id="appHeader" class="sticky top-0 z-10 border-b border-slate-200 flex items-center justify-between gap-3 backdrop-blur-md">
  <div class="flex items-center gap-2">
    <button id="themeToggle" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹"><span id="themeIcon">ğŸŒ</span></button>
    <h1 id="title" class="font-bold">ğŸ“– Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ… â€“ <span class="font-normal">ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</span></h1>
  </div>
  <div class="clock-box pr-1">
    <div id="hijriLine" class="hijri">â€”</div>
    <div id="gregLine" class="greg">â€”</div>
  </div>
</header>

<a id="whatsappFab" href="https://wa.me/905533331339" target="_blank" title="ÙˆØ§ØªØ³Ø§Ø¨">
  <img src="https://i.imgur.com/9fHveoY.png" alt="WhatsApp">
</a>

<nav class="top-tabs p-4 flex gap-2">
  <button id="tabAudio" class="btn tab-active">ğŸ”Š Ø§Ù„ØµÙˆØª</button>
  <button id="tabImages" class="btn tab-inactive">ğŸ–¼ï¸ Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆÙ‘Ø±</button>
</nav>

<main class="space-y-6">

  <!-- Ø§Ù„ØµÙˆØª -->
  <section id="audioSection" class="space-y-4">
    <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="card p-4">
        <h2 class="mb-2 font-semibold">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</h2>
        <select id="surahSelect" class="w-full p-2 rounded border text-black"></select>
      </div>
      <div class="card p-4">
        <h2 class="mb-2 font-semibold">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø±Ø¦</h2>
        <select id="reciterSelect" class="w-full p-2 rounded border text-black"></select>
      </div>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2">ÙˆØ¶Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„</h2>
      <div class="flex flex-wrap items-center gap-4 text-sm">
        <label><input type="radio" name="mode" value="single" checked> Ù‚Ø§Ø±Ø¦ ÙˆØ§Ø­Ø¯</label>
        <label><input type="radio" name="mode" value="multi"> Ø¹Ø¯Ø© Ù‚Ø±Ø§Ø¡</label>
        <label><input type="checkbox" id="loopToggle"> ØªÙƒØ±Ø§Ø± Ø§Ù„Ø³ÙˆØ±Ø©</label>
      </div>
      <div class="mt-3 flex flex-wrap gap-2 items-center text-sm">
        <label>â±ï¸ Ù…Ø¤Ù‚Ù‘Øª Ø§Ù„Ù†ÙˆÙ…</label>
        <input id="sleepMinutes" type="number" min="1" placeholder="Ø¯Ù‚Ø§Ø¦Ù‚" class="w-20 p-1 border rounded text-black">
        <button id="sleepSet" class="px-3 py-1 bg-slate-600 text-white rounded">ØªÙØ¹ÙŠÙ„</button>
        <button id="sleepCancel" class="px-3 py-1 bg-red-500 text-white rounded">Ø¥Ù„ØºØ§Ø¡</button>
        <span id="sleepStatus" class="text-sm"></span>
      </div>
    </section>

    <section class="flex gap-3">
      <button id="addBtn" class="flex-1 btn btn-gold">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø´ØºÙ„</button>
      <button id="favBtn" class="flex-1 btn btn-ghost">â­ Ù…ÙØ¶Ù„Ø©</button>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2 flex items-center justify-between">
        <span>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</span>
        <button id="clearBtn" class="btn btn-danger text-sm">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </h2>
      <ul id="playlist" class="space-y-2"></ul>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2">Ø§Ù„Ù…Ø´ØºÙ‘Ù„</h2>
      <div id="playerBox"></div>
      <div id="progressBar" class="mt-2 bg-gray-200 rounded-full h-2"><div id="progressFill" class="h-2 bg-emerald-500 rounded-full w-0"></div></div>
      <div class="flex items-center justify-center gap-2 mt-2">
        <button id="back10" class="btn">âª 10Ø«</button>
        <button id="playPause" class="btn">â¯ï¸ ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù</button>
        <button id="fwd10" class="btn">â© 10Ø«</button>
      </div>
      <div class="text-center mt-1 text-sm">
        <span id="timeNow">00:00</span> / <span id="timeTotal">00:00</span>
      </div>
    </section>

    <section class="card p-4">
      <h2 class="font-semibold mb-2 flex items-center justify-between">
        <span>â­ Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>
        <button id="clearFavBtn" class="btn btn-danger text-sm">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
      </h2>
      <ul id="favorites" class="space-y-2"></ul>
    </section>
  </section>

  <!-- Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆØ± -->
  <section id="imagesSection" class="space-y-4 hidden">
    <div class="card p-4">
      <h2 class="font-semibold mb-3">ğŸ“– Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆØ±</h2>
      <div class="quran-controls">
        <select id="surahImageSelect" class="text-black"></select>
        <div class="flex items-center gap-2 ms-auto">
          <button id="prevPage" class="btn">â¬…ï¸ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
          <input id="pageNum" type="number" min="1" max="604" value="1" class="w-20 p-1 border rounded text-black">
          <span>/ 604</span>
          <button id="nextPage" class="btn">Ø§Ù„ØªØ§Ù„ÙŠ â¡ï¸</button>
          <button id="fullscreenBtn" class="btn btn-gold">ğŸ“º</button>
        </div>
      </div>
      <div id="imageWrapper">
        <img id="quranPage" src="https://easyquran.com/wp-content/uploads/2022/09/1-scaled.jpg" alt="ØµÙØ­Ø© Ø§Ù„Ù…ØµØ­Ù">
      </div>
    </div>
  </section>

  <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³ÙƒØ±Ø¨Øª ÙÙŠ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© -->
</main>
<script>
/* ---------------------- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© ---------------------- */
const $ = id => document.getElementById(id);
const THEMES = ["day","night","special"];
let currentThemeIndex = 0;
const pad3 = n => String(n).padStart(3,"0");

/* ---------------------- Ø§Ù„Ø«ÙŠÙ…Ø§Øª ---------------------- */
function applyTheme(t){
  document.body.classList.remove("theme-day","theme-night","theme-special");
  document.body.classList.add("theme-"+t);
  $("themeIcon").textContent = t==="day"?"ğŸŒ":t==="night"?"ğŸŒ™":"ğŸ’š";
  localStorage.setItem("theme_choice",t);
}
function initTheme(){
  const saved = localStorage.getItem("theme_choice");
  if(saved && THEMES.includes(saved)){applyTheme(saved);currentThemeIndex=THEMES.indexOf(saved);}
  else{applyTheme("day");currentThemeIndex=0;}
}
$("themeToggle").onclick = ()=>{
  currentThemeIndex=(currentThemeIndex+1)%THEMES.length;
  applyTheme(THEMES[currentThemeIndex]);
};

/* ---------------------- Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª ---------------------- */
async function updateClock(){
  const d=new Date();
  const gDate=`${String(d.getDate()).padStart(2,"0")}-${String(d.getMonth()+1).padStart(2,"0")}-${d.getFullYear()}`;
  const time=`${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`;
  try{
    const res=await fetch(`https://api.aladhan.com/v1/gToH?date=${gDate}`);
    const j=await res.json();
    const hijri=`${j.data.hijri.day} ${j.data.hijri.month.ar} ${j.data.hijri.year} Ù‡Ù€`;
    $("hijriLine").textContent=hijri;
    $("gregLine").innerHTML=`${gDate} | <span class="time">${time}</span>`;
  }catch{
    $("hijriLine").textContent="â€”";
    $("gregLine").innerHTML=`${gDate} | <span class="time">${time}</span>`;
  }
}
setInterval(updateClock,60000);

/* ---------------------- ØªØ¨ÙˆÙŠØ¨Ø§Øª ---------------------- */
function setTab(tab){
  if(tab==="audio"){
    $("tabAudio").classList.add("tab-active");$("tabImages").classList.remove("tab-active");
    $("audioSection").classList.remove("hidden");$("imagesSection").classList.add("hidden");
  }else{
    $("tabImages").classList.add("tab-active");$("tabAudio").classList.remove("tab-active");
    $("imagesSection").classList.remove("hidden");$("audioSection").classList.add("hidden");
  }
}
$("tabAudio").onclick=()=>setTab("audio");
$("tabImages").onclick=()=>setTab("images");

/* ---------------------- Ø§Ù„ØµÙˆØª ---------------------- */
const RECITERS=[
  {slug:"maher",name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ",base:"https://server12.mp3quran.net/maher"},
  {slug:"ajm",name:"Ø§Ù„Ø´ÙŠØ® Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø¬Ù…ÙŠ",base:"https://server10.mp3quran.net/ajm"},
  {slug:"afs",name:"Ø§Ù„Ø´ÙŠØ® Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ",base:"https://server8.mp3quran.net/afs"},
  {slug:"sgmd",name:"Ø§Ù„Ø´ÙŠØ® Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ",base:"https://server7.mp3quran.net/s_gmd"},
  {slug:"shur",name:"Ø§Ù„Ø´ÙŠØ® Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø´Ø±ÙŠÙ…",base:"https://server7.mp3quran.net/shur"},
  {slug:"sds",name:"Ø§Ù„Ø´ÙŠØ® Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³",base:"https://server11.mp3quran.net/sds"}
];
let chapters=[];
const state={playlist:[],favorites:[],idx:0,mode:"single",loop:false,resume:{},sleepTimeout:null};

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ± */
async function fetchChapters(){
  try{
    const r=await fetch("https://api.quran.com/api/v4/chapters");
    const j=await r.json();chapters=j.chapters||[];
  }catch{chapters=[...Array(114)].map((_,i)=>({id:i+1,name_arabic:`Ø³ÙˆØ±Ø© ${i+1}`}));}
  $("surahSelect").innerHTML=chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
  $("reciterSelect").innerHTML=RECITERS.map(r=>`<option value="${r.slug}">${r.name}</option>`).join("");
  $("surahImageSelect").innerHTML=`<option value="0">ğŸ“– ÙƒØ§Ù…Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù†</option>`+chapters.map(c=>`<option value="${c.id}">${c.id}. ${c.name_arabic}</option>`).join("");
}

/* Ø§Ù„ØµÙˆØªÙŠØ§Øª */
function persist(){
  localStorage.setItem("playlist",JSON.stringify(state.playlist));
  localStorage.setItem("favorites",JSON.stringify(state.favorites));
  localStorage.setItem("resume",JSON.stringify(state.resume));
}
function render(auto=false){
  const cur=state.playlist[state.idx];
  if(cur){
    $("playerBox").innerHTML=`<div class="mb-2 font-medium">${cur.title} â€“ <span class="text-emerald-600">${cur.reciter}</span></div><audio id="player" src="${cur.src}" controls ${auto?'autoplay':''}></audio>`;
    const a=$("player");
    a.loop=state.loop;
    a.ontimeupdate=()=>{if(!isFinite(a.duration))return;$("progressFill").style.width=(a.currentTime/a.duration*100)+"%";$("timeNow").textContent=formatTime(a.currentTime);state.resume[cur.src]=a.currentTime;localStorage.setItem("resume",JSON.stringify(state.resume));};
    a.onloadedmetadata=()=>{$("timeTotal").textContent=formatTime(a.duration);if(state.resume[cur.src])a.currentTime=state.resume[cur.src];};
    a.onended=()=>{if(state.loop)a.play();else if(state.idx+1<state.playlist.length){state.idx++;render(true);}};
  }else{$("playerBox").innerHTML="<div class='text-slate-500'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ´ØºÙŠÙ„</div>";}
  $("playlist").innerHTML=state.playlist.map((t,i)=>`<li class="flex justify-between bg-white/60 rounded px-3 py-2"><span>${t.title} - ${t.reciter}</span><span><button onclick="playAt(${i})">â–¶ï¸</button><button onclick="addFav(${i})">â­</button><button onclick="delAt(${i})">ğŸ—‘ï¸</button></span></li>`).join("");
  renderFav();
}
function add(auto=false){
  const rslug=$("reciterSelect").value;
  const rec=RECITERS.find(r=>r.slug===rslug);
  const sid=parseInt($("surahSelect").value);
  const sur=chapters.find(c=>c.id===sid)||{name_arabic:`Ø³ÙˆØ±Ø© ${sid}`};
  if(!rec||!sid)return;
  if(state.mode==="single" && state.playlist.length>0 && state.playlist[0].reciter!==rec.name)return alert("ÙÙŠ ÙˆØ¶Ø¹ Ù‚Ø§Ø±Ø¦ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·.");
  state.playlist.push({title:sur.name_arabic,reciter:rec.name,src:`${rec.base}/${pad3(sid)}.mp3`});
  state.idx=state.playlist.length-1;persist();render(auto);
}
function playAt(i){state.idx=i;render(true);}
function delAt(i){state.playlist.splice(i,1);if(state.idx>=state.playlist.length)state.idx=state.playlist.length-1;persist();render(false);}
function addFav(i){const it=state.playlist[i];if(!it)return;if(!state.favorites.some(f=>f.src===it.src)){state.favorites.push(it);persist();renderFav();}}
function renderFav(){$("favorites").innerHTML=state.favorites.map((f,i)=>`<li class="flex justify-between bg-white/60 rounded px-3 py-2"><span>${f.title} - ${f.reciter}</span><span><button onclick="playFav(${i})">â–¶ï¸</button><button onclick="delFav(${i})">ğŸ—‘ï¸</button></span></li>`).join("");}
function playFav(i){const it=state.favorites[i];if(!it)return;state.playlist.push(it);state.idx=state.playlist.length-1;persist();render(true);}
function delFav(i){state.favorites.splice(i,1);persist();renderFav();}
function formatTime(s){if(!s||!isFinite(s))return"00:00";const m=Math.floor(s/60),sec=Math.floor(s%60);return`${String(m).padStart(2,"0")}:${String(sec).padStart(2,"0")}`;}

/* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
$("addBtn").onclick=()=>add(true);
$("favBtn").onclick=()=>{const cur=state.playlist[state.idx];if(cur&&!state.favorites.some(f=>f.src===cur.src)){state.favorites.push(cur);persist();renderFav();}};
$("clearBtn").onclick=()=>{if(confirm("Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„ØŸ")){state.playlist=[];state.idx=0;persist();render(false);}};
$("clearFavBtn").onclick=()=>{if(confirm("Ù…Ø³Ø­ Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ")){state.favorites=[];persist();renderFav();}};
$("playPause").onclick=()=>{const a=$("player");if(a)a.paused?a.play():a.pause();};
$("back10").onclick=()=>{const a=$("player");if(a)a.currentTime=Math.max(0,a.currentTime-10);};
$("fwd10").onclick=()=>{const a=$("player");if(a)a.currentTime=Math.min(a.duration||a.currentTime+10,a.currentTime+10);};
$("loopToggle").onchange=e=>{state.loop=e.target.checked;persist();const a=$("player");if(a)a.loop=state.loop;};
document.querySelectorAll("input[name='mode']").forEach(r=>r.onchange=e=>state.mode=e.target.value);

/* Ù…Ø¤Ù‚Øª Ø§Ù„Ù†ÙˆÙ… */
$("sleepSet").onclick=()=>{
  const min=parseInt($("sleepMinutes").value);
  if(isNaN(min)||min<=0)return alert("Ø£Ø¯Ø®Ù„ Ø¯Ù‚Ø§Ø¦Ù‚ ØµØ­ÙŠØ­Ø©");
  if(state.sleepTimeout)clearTimeout(state.sleepTimeout);
  state.sleepTimeout=setTimeout(()=>{const a=$("player");if(a)a.pause();$("sleepStatus").textContent="â¹ï¸ ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù";},min*60000);
  $("sleepStatus").textContent=`Ø³ÙŠØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø¨Ø¹Ø¯ ${min} Ø¯Ù‚ÙŠÙ‚Ø©`;
};
$("sleepCancel").onclick=()=>{if(state.sleepTimeout)clearTimeout(state.sleepTimeout);$("sleepStatus").textContent="ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡";};

/* ---------------------- Ø§Ù„Ù…ØµØ­Ù Ø§Ù„Ù…ØµÙˆØ± ---------------------- */
const TOTAL_PAGES=604;
const BASE="https://easyquran.com/wp-content/uploads/2022/09/";
const imgEl=$("quranPage");
const pageInput=$("pageNum");
function buildUrl(p){return`${BASE}${p}-scaled.jpg`;}
function loadPage(n){const p=Math.max(1,Math.min(TOTAL_PAGES,parseInt(n)||1));pageInput.value=p;imgEl.src=buildUrl(p);}
$("nextPage").onclick=()=>loadPage(+pageInput.value+1);
$("prevPage").onclick=()=>loadPage(+pageInput.value-1);
pageInput.onchange=()=>loadPage(pageInput.value);
$("surahImageSelect").onchange=e=>{const id=parseInt(e.target.value);if(id===0)loadPage(1);else if(SURAH_PAGES[id])loadPage(SURAH_PAGES[id]);};

/* Ø³Ø­Ø¨ ÙŠØ¯ÙˆÙŠ (ÙŠÙ…ÙŠÙ†=Ø§Ù„ØªØ§Ù„ÙŠØŒ ÙŠØ³Ø§Ø±=Ø§Ù„Ø³Ø§Ø¨Ù‚) Ø¨Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù†Ø®ÙØ¶Ø© */
let touchStartX=0;
imgEl.addEventListener("touchstart",e=>{touchStartX=e.changedTouches[0].screenX;},{passive:true});
imgEl.addEventListener("touchend",e=>{
  const dx=e.changedTouches[0].screenX-touchStartX;
  if(Math.abs(dx)>100){ // Ø­Ø³Ø§Ø³ÙŠØ© Ø£Ø®Ù
    if(dx>0)loadPage(+pageInput.value+1);
    else loadPage(+pageInput.value-1);
  }
},{passive:true});

/* Ø¹Ø¬Ù„Ø© Ø§Ù„Ù…Ø§ÙˆØ³ (Scroll): Ù„Ù„Ø£Ø³ÙÙ„ â†’ Ø§Ù„ØªØ§Ù„ÙŠØŒ Ù„Ù„Ø£Ø¹Ù„Ù‰ â†’ Ø§Ù„Ø³Ø§Ø¨Ù‚ */
$("imageWrapper").addEventListener("wheel",e=>{
  if(e.deltaY>0)loadPage(+pageInput.value+1);
  else if(e.deltaY<0)loadPage(+pageInput.value-1);
});

/* Ø§Ù„Ø£Ø³Ù‡Ù… ÙÙŠ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© ÙÙ‚Ø· */
document.addEventListener("keydown",e=>{
  if(document.fullscreenElement){
    if(e.key==="ArrowRight")loadPage(+pageInput.value+1);
    if(e.key==="ArrowLeft")loadPage(+pageInput.value-1);
  }
});

/* Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© */
$("fullscreenBtn").onclick=()=>{
  const wrap=$("imageWrapper");
  if(wrap.requestFullscreen)wrap.requestFullscreen();
  else if(wrap.webkitRequestFullscreen)wrap.webkitRequestFullscreen();
};

/* ---------------------- ØªÙ‡ÙŠØ¦Ø© ---------------------- */
window.onload=()=>{
  initTheme();updateClock();fetchChapters();
  state.playlist=JSON.parse(localStorage.getItem("playlist")||"[]");
  state.favorites=JSON.parse(localStorage.getItem("favorites")||"[]");
  state.resume=JSON.parse(localStorage.getItem("resume")||"{}");
  render(false);renderFav();loadPage(1);
};
</script>
